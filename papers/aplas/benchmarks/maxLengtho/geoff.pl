p(Ls,M,L) :- p_(M,Ls,L).
p_(M,[o|T],s(Z)) :- p_(M,T,Z).
p_(M,[s(Zz)|T],s(Z)) :- p__(T,Zz,M),p_____(T,Z).
p_(o,[],o).
p__([o|T__],Zz,M) :- p__(T__,Zz,M).
p__([s(X1)|T__],Zz,M) :- p___(X1,Zz,T__,Zz,M).
p__([s(X1)|T__],Zz,M) :- p____(X1,Zz,T__,X1,M).
p__([],Zz,s(Zz)).
p___(o,X_____,T__,X_______,M) :- p__(T__,X_______,M).
p___(s(X1_),s(Y1_),T__,X_______,M) :- p___(X1_,Y1_,T__,X_______,M).
p____(s(X1_),s(Y1_),T__,X_______,M) :- p____(X1_,Y1_,T__,X_______,M).
p____(s(Zz_),o,T__,X_______,M) :- p__(T__,X_______,M).
p_____([H__|T__],s(Z_)) :- p_____(T__,Z_).
p_____([],o).
<- p(Ls,M,L).